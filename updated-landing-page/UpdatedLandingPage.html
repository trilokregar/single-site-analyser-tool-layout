<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bootstrap -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
      integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N"
      crossorigin="anonymous"
    />

    <!-- Css -->
    <link rel="stylesheet" href="./style.css" />
    <link rel="stylesheet" href="./UpdatedLandingPage.css" />

    <!-- Leaflet Css -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
      integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
      crossorigin=""
    />

    <!-- Leaflet Js -->
    <script
      src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
      integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
      crossorigin=""
    ></script>

    <!-- Google Places Script -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAyNKf7voTUe4srInb3fdwxoJRDZhFvrwA&libraries=places&callback=initialize"></script>

    <!-- Font-awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"
      integrity="sha512-5A8nwdMOWrSz20fDsjczgUidUBR8liPYU+WymTZP1lmY9G6Oc7HlZv156XqnsgNUzTyMefFTcsFH/tnJE/+xBg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Jost:wght@300;400;500&display=swap"
      rel="stylesheet"
    />

    <!-- External JS -->
    <script type="text/javascript" src="./SiteAnalyserFunctions.js"></script>
    <script type="text/javascript" src="./TargetGroupsList.js"></script>
    <script type="text/javascript" src="./PoiMarkers.js"></script>
    <script type="text/javascript" src="./MarkersConstants.js"></script>
    <script type="text/javascript" src="./PointOfInterestList.js"></script>
    
    <!-- jquery -->
    <script src="./jquery.js"></script>
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/bxslider/4.2.15/jquery.bxslider.min.js"></script> -->

    <!-- Leaflet style and js -->
    <!-- <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script> -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.3/leaflet.js"></script>
    
    <!-- Leaflet-Heatmap js -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.heat/0.2.0/leaflet-heat.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/heatmap.js/2.0.0/heatmap.js"></script>
    <script type="text/javascript" src="./leaflet-heatmap.js"></script>


    <title>Updated Landing Page</title>
  </head>
  <body>
    <!-- body -->
    <div class="bg-img">
      <!-- Heading -->
      <div class="py-4 heading-height">
        <div class="d-flex justify-content-between bg-lightorange p-3">
          <div class="col-10 px-0">
            <h1 class="text-white landing-page-header text-truncate">
              AI Driven Solutions for OOH Advertizing
            </h1>
            <h3 class="text-white landing-page-sub-header mb-0 mt-3 text-truncate">
              GENERATE ANALYSIS REPORT FOR
              <span class="text-danger">BILLBOARDS</span> ABSOLUTELY FREE!
            </h3>
          </div>

          <!-- Logo and Tell-Me-More -->
          <div class="text-center col-2 px-0">
            <img
              src="/assets/landing-page/admavinLogo.svg"
              alt="admavin-logo"
              height="60"
            />
            <a class="d-block mt-3" href="#offerings">
              <button class="btn rounded-pill shadow-none">
                <h4 class="font-weight-bold mb-0">TELL ME MORE</h4>
              </button>
            </a>
          </div>
        </div>
      </div>

      <!-- Map Section -->
      <div id="map" class="mx-4 rounded-lg border map-height">
        <!-- Location-Search, Lat-Lng and Influence-Radius -->
        <div class="d-flex map-action-inputs stop-propagation">
          <!-- Location-search -->
          <div class="col-5 p-0 mr-3">
            <i class="fa fa-search search-icon"></i>
            <input
              id="places-autocomplete"
              type="text"
              value=""
              class="form-control rounded-lg shadow-none pl-5 pr-4"
              placeholder="Search Location"
            />
            <button
              type="button"
              class="close autocomplete-clear"
              onclick="clearAddressLatLngMarker()"
            >
              &times;
            </button>
          </div>

          <!-- latitude -->
          <input
            id="latitude"
            type="number"
            value=""
            class="form-control col-2 rounded-lg shadow-none"
            placeholder="Latitude"
          />

          <!-- longitude -->
          <input
            id="longitude"
            type="number"
            value=""
            class="form-control col-2 rounded-lg shadow-none mx-3"
            placeholder="Longitude"
          />

          <!-- radius of influence -->
          <div class="form-group col-3 p-0 mb-0 shadow-none">
            <select
              id="radius-options"
              class="form-control shadow-none"
              name="radius"
            >
              <option value="1000" disabled selected>Select Radius of Influence</option>
              <option value="1000">1 KM</option>
              <option value="2000">2 KM</option>
              <option value="3000">3 KM</option>
              <option value="4000">4 KM</option>
              <option value="5000">5 KM</option>
            </select>
          </div>
        </div>

        <!-- TG and POI Tab Buttons -->
        <div class="map-action-tabs">
          <div
            id="tg-tab-button"
            class="map-tab border rounded-lg mb-3 stop-propagation"
            style="background-color: white;"
          >
            <i class="fa fa-users my-1 fa-size"></i>
            <p class="mb-0">Target Group</p>
          </div>
          <div
            id="poi-tab-button"
            class="map-tab border rounded-lg mb-3 stop-propagation"
            style="background-color: white;"
          >
            <i class="fa fa-compass my-1 fa-size"></i>
            <p class="mb-0">Point Of Interest</p>
          </div>
        </div>

        <!-- Tg-Tab Content -->
        <div id="tg-tab-content" class="map-tab-content border rounded-lg bg-white stop-propagation p-3" style="display:none;">
          <!-------------- Header ----------->
          <span class="mb-0 h4">Target Groups</span>
          <hr class="my-2" />

          <!--------------- Body ------------>
          <!-- Selectables -->
          <div id="tg-list"></div>
          <!-- Un-Selectables -->
          <div id="un-selectable-tg-list">
            <div class="d-flex justify-content-between align-items-center my-1">
              <p class="mb-0">Mothers</p>
              <button
                class="btn py-1 px-3 shadow-none add-button stop-propagation"
                data-toggle="modal"
                data-target="#un-selectable-tg-modal"
              >
                Select
              </button>
            </div>
            <hr class="my-0" />
            <div class="d-flex justify-content-between align-items-center my-1">
              <p class="mb-0">Working Females</p>
              <button
                class="btn py-1 px-3 shadow-none add-button stop-propagation"
                data-toggle="modal"
                data-target="#un-selectable-tg-modal"
              >
                Select
              </button>
            </div>
            <hr class="my-0" />
            <div class="d-flex justify-content-between align-items-center my-1">
              <p class="mb-0">Working Males</p>
              <button
                class="btn py-1 px-3 shadow-none add-button stop-propagation"
                data-toggle="modal"
                data-target="#un-selectable-tg-modal"
              >
                Select
              </button>
            </div>
            <hr class="my-0" />
            <div class="d-flex justify-content-between align-items-center my-1">
              <p class="mb-0">Female Youth</p>
              <button
                class="btn py-1 px-3 shadow-none add-button stop-propagation"
                data-toggle="modal"
                data-target="#un-selectable-tg-modal"
              >
                Select
              </button>
            </div>
            <hr class="my-0" />
            <div class="d-flex justify-content-between align-items-center my-1">
              <p class="mb-0">Male Youth</p>
              <button
                class="btn py-1 px-3 shadow-none add-button stop-propagation"
                data-toggle="modal"
                data-target="#un-selectable-tg-modal"
              >
                Select
              </button>
            </div>
            <hr class="my-0" />
            <div class="d-flex justify-content-between align-items-center my-1">
              <p class="mb-0">Luxury Car Owners</p>
              <button
                class="btn py-1 px-3 shadow-none add-button stop-propagation"
                data-toggle="modal"
                data-target="#un-selectable-tg-modal"
              >
                Select
              </button>
            </div>
            <hr class="my-0" />
            <div class="d-flex justify-content-between align-items-center my-1">
              <p class="mb-0">Luxury Apartment Owners</p>
              <button
                class="btn py-1 px-3 shadow-none add-button stop-propagation"
                data-toggle="modal"
                data-target="#un-selectable-tg-modal"
              >
                Select
              </button>
            </div>
          </div>
        </div>

        <!-- Poi-Tab Content -->
        <div id="poi-tab-content" class="map-tab-content border rounded-lg bg-white stop-propagation p-3" style="display:none;">
            <!------------ Header ---------->
            <span class="mb-0 h4">Point Of Interest</span>
            <hr class="my-2" />

            <!------------- Body ----------->
            <div class="d-flex">
              <div class="col-6 pl-0 border-right">
                <div class="nav flex-column" id="poi-groups-list" role="tablist" aria-orientation="vertical"></div>
              </div>
              <div class="col-6 pr-0">
                <div class="tab-content" id="pois-list"></div>
              </div>
            </div>
          </div>

        <!-- (Generate Report / Download-sample-report) Button -->
        <div class="map-action-generate-report">
          <button
            class="btn rounded-pill shadow-none d-block stop-propagation"
            data-toggle="modal"
            data-target="#generate-report-modal"
          >
            <h5 class="font-weight-bold mb-0">Generate Report</h5>
          </button>
          <button
            id="sample-report-btn"
            class="btn rounded-pill shadow-none mt-2 d-flex bg-lightgray stop-propagation"
          >
            <h5 class="font-weight-bold mb-0">Download Sample Report</h5>
            <img
              class="sample-report-pdf"
              src="../assets/landing-page/pdf-file.png"
              height="50"
              alt="sample-report"
            />
          </button>
        </div>
      </div>

      <!-- Animation -->
      <div class="carousel carousel-height bg-white p-2 scroll">
        <span><b>LOVED AND TRUSTED BY INDUSTRY LEADERS</b></span>

        <div class="slider mt-2">
          <div class="slide-track">
            <div class="slide">
              <img
                class="madison-img"
                src="/pages/assets/why-admavin/madison.png"
                alt="madison"
              />
            </div>
            <div class="slide">
              <img
                class="starbucks-img"
                src="/pages/assets/why-admavin/starbucks.png"
                alt="starbucks"
              />
            </div>
            <div class="slide">
              <img
                class="snapdeal-img"
                src="/pages/assets/why-admavin/snapdeal.png"
                alt="snapdeal"
              />
            </div>
            <div class="slide">
              <img
                class="amazon-img"
                src="/pages/assets/why-admavin/amazon.png"
                alt="amazon"
              />
            </div>
            <div class="slide">
              <img
                class="rapport-img"
                src="/pages/assets/why-admavin/raport.png"
                alt="rapport"
              />
            </div>
            <div class="slide">
              <img
                class="hindustan-unilever-img"
                src="/pages/assets/why-admavin/Hindustan_Unilever.png"
                alt="hindustan-unilever"
              />
            </div>
            <div class="slide">
              <img
                class="bmw-img"
                src="/pages/assets/why-admavin/bmw.png"
                alt="bmw"
              />
            </div>
            <div class="slide">
              <img
                class="zomato-img"
                src="/pages/assets/why-admavin/zomato.png"
                alt="zomato"
              />
            </div>
            <div class="slide">
              <img
                class="madison-img"
                src="/pages/assets/why-admavin/madison.png"
                alt="madison"
              />
            </div>
            <div class="slide">
              <img
                class="starbucks-img"
                src="/pages/assets/why-admavin/starbucks.png"
                alt="starbucks"
              />
            </div>
            <div class="slide">
              <img
                class="snapdeal-img"
                src="/pages/assets/why-admavin/snapdeal.png"
                alt="snapdeal"
              />
            </div>
            <div class="slide">
              <img
                class="amazon-img"
                src="/pages/assets/why-admavin/amazon.png"
                alt="amazon"
              />
            </div>
            <div class="slide">
              <img
                class="rapport-img"
                src="/pages/assets/why-admavin/raport.png"
                alt="rapport"
              />
            </div>
            <div class="slide">
              <img
                class="hindustan-unilever-img"
                src="/pages/assets/why-admavin/Hindustan_Unilever.png"
                alt="hindustan-unilever"
              />
            </div>
            <div class="slide">
              <img
                class="bmw-img"
                src="/pages/assets/why-admavin/bmw.png"
                alt="bmw"
              />
            </div>
            <div class="slide">
              <img
                class="zomato-img"
                src="/pages/assets/why-admavin/zomato.png"
                alt="zomato"
              />
            </div>
          </div>
        </div>
      </div>

      <!-- Generate Report Modal -->
      <div class="modal fade" id="generate-report-modal" data-backdrop="static">
        <div
          class="modal-dialog modal-lg modal-dialog-centered"
          role="document"
        >
          <!-- modal-content-for-SUBMISSION -->
          <div id="content-for-submission" style="display:block;" class="modal-content">
            <div class="d-flex justify-content-between p-3 px-5">
              <img class="mt-2" src="../assets/landing-page/email-pic.svg" alt="mail-logo" height="40" />
              <h4 class="font-weight-bold text-center mb-0">
                Please Enter your Email ID <br />
                to receive your free site report for the day
              </h4>
              <img class="mt-2 cursor-pointer" src="../assets/landing-page/close-img.png" alt="close" height="40" data-dismiss="modal" aria-label="Close" />
            </div>

            <div class="modal-body-edit">
              <form name="emailform" action="#">
                <input
                  id="gen-rep-email-input"
                  type="search"
                  class="form-control"
                  name='email'
                  value=""
                  placeholder="username@email.com"
                  autocomplete="on"
                />
                <p id="invalid-email-message" class="my-2 text-danger"></p>
              </form>
              <div class="d-flex">
                <input id="gen-rep-privacy-check" type="checkbox" class="checkbox-size cursor-pointer" />
                <p class="mb-0 ml-2">
                  By ticking this box, I agree that I have read AdMAVIN's
                  <a href="https://staging.admavin.com/legal/privacy" target="_blank">privacy policy.</a>
                </p>
              </div>
              <div class="text-right pt-4">
                <button class="btn px-5" onclick="validateEmailAndGenerateReport(document.emailform.email)">
                  <h6 class="mb-0 font-weight-bold">OK</h6>
                </button>
              </div>
            </div>
          </div>
        
          <!-- modal-content-for-SUCCESS -->
          <div id="content-for-success" style="display:none;" class="modal-content">
            <div class="d-flex justify-content-between p-3 px-5">
              <img class="" src="../assets/landing-page/success-img.svg" alt="success-thumbsup" height="50" />
              <h4 class="text-success font-weight-bold text-center mt-3">
                Congratulations!!!
              </h4>
              <img class="mt-2 cursor-pointer" src="../assets/landing-page/close-img.png" alt="close" height="40" data-dismiss="modal" aria-label="Close" />
            </div>

            <div class="px-5 mx-2 pb-5 pt-3">
              <h4 class="text-success text-center">
                Check your Email for detailed site report.<br/>
                Try generating more reports after 24 hours.
              </h4>
              <div class="d-flex justify-content-between pt-4">
                <button class="btn" data-dismiss="modal">
                  <h6 class="mb-0 font-weight-bold">OK, I will try again</h6>
                </button>
                <a href="https://calendly.com/atul-singh-4/30min" target="_blank">
                  <button class="btn">
                    <h6 class="mb-0 font-weight-bold">Take full subscription and generate unlimited reports</h6>
                  </button>
                </a>
              </div>
            </div>
          </div>

          <!-- modal-content-for-FAILURE -->
          <div id="content-for-failure" style="display:none;" class="modal-content">
            <div class="d-flex justify-content-between p-3 px-5">
              <img class="mt-2" src="../assets/landing-page/failed-clock.svg" alt="failed-clock" height="50" />
              <h4 class="text-danger font-weight-bold text-center mt-3">
                Try again after sometime!
              </h4>
              <img class="mt-2 cursor-pointer" src="../assets/landing-page/close-img.png" alt="close" height="40" data-dismiss="modal" aria-label="Close" />
            </div>

            <div class="px-5 mx-2 pb-5 pt-3">
              <h4 class="text-danger text-center">
                You have generated a report using the same email id in less than 24 hours from now.
              </h4>
              <div class="d-flex justify-content-between pt-4">
                <button class="btn" data-dismiss="modal">
                  <h6 class="mb-0 font-weight-bold">OK, I will try again</h6>
                </button>
                <a href="https://calendly.com/atul-singh-4/30min" target="_blank">
                  <button class="btn">
                    <h6 class="mb-0 font-weight-bold">Take full subscription and generate unlimited reports</h6>
                  </button>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Un-Selectable Target-Group Message Modal -->
      <div class="modal fade" id="un-selectable-tg-modal" data-backdrop="static">
        <div class="modal-dialog mt-1" role="document">
          <div class="modal-content">
            <div class="modal-body">
              <p class="font-weight-bold mb-0">Sorry, you can't select other Target Group except
                <span class="text-danger">Top Three.</span>
                  <br />
                  To unlock it's full potential, take
                <a
                  href="https://calendly.com/atul-singh-4/30min"
                  class="text-success"
                  target="_blank"
                >
                  Full Subscription.
                  <img
                    src="../assets/landing-page/hyperlink-img.png"
                    class="mb-1"
                    height="15"
                  />
                </a>
              </p>
            </div>
            <div class="modal-body d-flex justify-content-end">
              <button type="button" class="btn font-weight-bold shadow-none" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>

      <!-- "Can't Select More than 3 POI" Message Modal -->
      <div class="modal fade" id="poi-limit-msg-modal" data-backdrop="static">
        <div class="modal-dialog mt-1" role="document">
          <div class="modal-content">
            <div class="modal-body">
              <p class="font-weight-bold mb-0">Sorry, you can't add more than
                <span class="text-danger">Three POI's.</span>
                  <br />
                  To unlock it's full potential, take
                <span class="text-success">
                  <a
                    href="https://calendly.com/atul-singh-4/30min"
                    class="text-success"
                    target="_blank"
                  >
                    Full Subscription.
                    <img
                      src="../assets/landing-page/hyperlink-img.png"
                      class="mb-1"
                      height="15"
                    />
                  </a>
                </span>
              </p>
            </div>
            <div class="modal-body d-flex justify-content-end">
              <button type="button" class="btn font-weight-bold shadow-none" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!--------------------- SCRIPTS ---------------------->
    <script>
      // ------------- Global Variables Declaration ------------------- //
      // Initials
      var latitude = 28.661335;
      var longitude = 77.215618;
      var initialZoom = 11;
      var initialBounds;
      
      // Scrollables
      var scrollZoom;
      var scrollBounds;
      
      // TG
      var selectedTgId = "";
      var selectedTgName = "";
      var selectedTgResultingPoiLayers = [];
      var allHeatMapPointsArr = [];
      var existingHeatmap;

      // POI
      var poiSelectionLoading = false;
      var selectedPoiName = "";
      var selectedPoiGroupName = "";
      var finalSelectedPoisInfo = {};
      var poisMarkerMap = {};
      var poiMarkers = [];

      // Others
      var searchedPlaceName = "";
      var existingMarker;
      var selectedTab = 0;


      // jquery variables (which are used OneTime OR more than "Once")
      const $universalSelection = $("*");
      // All ID's
      const $latitude = $("#latitude");
      const $longitude = $("#longitude");
      const $radiusOptions = $('#radius-options');
      const $placesAutocomplete = $("#places-autocomplete");

      const $contentForSubmission = $("#content-for-submission");
      const $contentForSuccess = $("#content-for-success");
      const $contentForFailure = $("#content-for-failure");
      const $invalidEmailMessage = $("#invalid-email-message");
      const $generateReportEmailInput = $("#gen-rep-email-input");
      const $generateReportPrivacyCheck = $("#gen-rep-privacy-check");
      const $sampleReportDownloadBtn = $("#sample-report-btn");

      const $generateReportModal = $('#generate-report-modal');
      
      const $tgTabButton = $("#tg-tab-button");
      const $poiTabButton = $("#poi-tab-button");
      const $tgTabContent = $("#tg-tab-content");
      const $poiTabContent = $("#poi-tab-content");
      const $targetGroupsList = $("#tg-list");
      const $poisGroupList = $("#poi-groups-list");
      const $poisList = $(`#pois-list`);
      
      // All CLASSES
      const $cls_stopPropagation = $(".stop-propagation");

      
      /// --------------------- MAP JS START ------------------------- ///
      const map = L.map("map", { maxZoom: 18, minZoom: 10 })
      _setMapView(latitude, longitude, initialZoom);
      
      // fixing position of "zoomControl"
      map.zoomControl.setPosition("bottomright");

      // getting "initialBounds";
      initialBounds = map.getBounds();

      /// --------- Tile-Layer : Attribution and Link ------------ ///
      L.tileLayer("https://{s}.tile.osm.org/{z}/{x}/{y}.png", {
        attribution:
          '&copy; <a target="_blank" href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
      }).addTo(map);

      /// ------------ MAP SCROLL INFO (mouse + zoomControl) -------------- ///
      map.on('zoomend', function(event) {
        scrollZoom = event.target.getZoom();
        scrollBounds = event.target.getBounds();
      });

      /// -------------- MAP CLICK INFO -------------- ///
      map.on('click', function(event) {
        const { latlng } = event;
        const { lat: clickLatitude, lng: clickLongitude } = latlng;

        // Updating the "Input-Values"
        _addLatLngInputValues(clickLatitude, clickLongitude);

        // Updating the "Marker" with "MapView"
        updateMarkerWithMapView(scrollZoom);
      });

      /// --------------- MANUALLY GIVING LAT-LNG FROM INPUTS -------------- ///
      $latitude.on("keyup paste cut", () => updateMarkerWithMapView(initialZoom));
      $longitude.on("keyup paste cut", () => updateMarkerWithMapView(initialZoom));

      /// ----------------------- PLACES AUTOCOMPLETE --------------------- ///
      function initialize() {
        const inputElement = $placesAutocomplete[0];
        const autocomplete = new google.maps.places.Autocomplete(inputElement);
        google.maps.event.addListener(
          autocomplete,
          "place_changed",
          function () {
            const place = autocomplete.getPlace();
            const { geometry, formatted_address: address, name } = place;
            // getting lat-lng and "searchedPlaceName"
            const searchedLatitude = geometry.location.lat();
            const searchedLongitude = geometry.location.lng();
            searchedPlaceName = name;

            // adding lat-lng inputs from autoplaces
            _addLatLngInputValues(searchedLatitude, searchedLongitude);

            // Setting MapView to "Searched-Location"
            _setMapView(searchedLatitude, searchedLongitude, initialZoom);

            // remove previous marker
            _removeMarker(existingMarker);

            // add new marker
            _addMarkerWithPopup(searchedLatitude, searchedLongitude, blueIcon);
          }
        );
      }
      google.maps.event.addDomListener(window, "load", initialize);
      /// ---------------- MAP JS END ---------------- ///

      /// ------- CLEAR AUTOCOMPLETE-VALUES FUNCTION -------- ///
      function clearAddressLatLngMarker() {
        // resetting values
        _clearAutoCompleteValues();

        // clearing Lat-Lng Inputs
        _clearLatLngInputValues();

        // remove previous marker
        _removeMarker(existingMarker);
      }

      /// -------------- "UPDATE-MARKER" AND "SET MAP-VIEW"  -------------- ///
      function updateMarkerWithMapView(zoomLvl) {
        // clearing places-autocomplete-values
        _clearAutoCompleteValues();

        // getting latest "Lat-Lng-inputs" values
        const { inputLat, inputLng } = _getLatLngValues();

        // remove previous marker
        _removeMarker(existingMarker);

        // add new marker
        if (inputLat && inputLng) {
          _addMarkerWithPopup(inputLat, inputLng, blueIcon);

          // Setting MapView
          _setMapView(inputLat, inputLng, zoomLvl);
        }
      }

      /// ---------------- TG-TAB CLICK ---------------- ///
      $tgTabButton.on("click", function() {
        if (selectedTab === 1) {
          $tgTabButton.css("background-color", "white");
          $tgTabContent.css("display", "none");
          $poiTabContent.css("display", "none");
          selectedTab = 0;
          return;
        }
        selectedTab = 1;
        $tgTabContent.css("display", "block");
        $poiTabContent.css("display", "none");
        $tgTabButton.css("background-color", "lightgray");
        $poiTabButton.css("background-color", "white");
      });

      /// ---------------- POI-TAB CLICK ---------------- ///
      $poiTabButton.on("click", function() {
        if (selectedTab === 2) {
          $poiTabButton.css("background-color", "white");
          $poiTabContent.css("display", "none");
          $tgTabContent.css("display", "none");
          selectedTab = 0;
          return;
        }
        selectedTab = 2;
        $poiTabContent.css("display", "block");
        $tgTabContent.css("display", "none");
        $poiTabButton.css("background-color", "lightgray");
        $tgTabButton.css("background-color", "white");
      });

      /// --------------------- TG LIST MAPPING (selectable) ------------------------ ///
      TargetGroupsList.map((targetGroup) => {
        const { id, name: tgName } = targetGroup;

        // Appending "All-Target-Groups" inside Div
        $targetGroupsList.append(
          `<div class="d-flex justify-content-between align-items-center my-1">
            <p class="mb-0 font-weight-bold">${tgName}</p>
            <div class="d-flex">
              <div id="spinner-${id}"></div>
              <button
                data-tg-id="${id}"
                class="btn py-1 px-3 shadow-none add-button btn-tg-select"
              >
                Select
            </button>
            </div>
          </div>
          <hr class="my-0" />`
        );
      });

      /// ------------------------- SELECT TARGET GROUP --------------------------- ///
      const $tgSelectButton = $(".btn-tg-select");
      $tgSelectButton.on('click', function(){
        const $tgBtn = $(this);
        // get tgId
        const { tgId } = $tgBtn.data();

        // if same tg selected then do nothing else call API
        if (selectedTgId === tgId) {
          return;
        } else {
          const {name, resultLayers } = TargetGroupsList.find((eachTg) => eachTg.id === tgId);

          // updating Variables
          selectedTgId = tgId;
          selectedTgName = name;

          // getting all "resultingPoiLayerIds"
          const resPoiLayers = resultLayers.map((eachLayer) => eachLayer.poiTypeId);
          selectedTgResultingPoiLayers = resPoiLayers;

          // Clear other selected (CSS)
          $tgSelectButton.removeClass('selected').text('Select');
          // Change the colour and text of the current button
          $tgBtn.addClass('selected').text('Selected');

          // Setting "Loading = true" for Tg-Selection
          $(`#spinner-${selectedTgId}`).html(_spinner("spinner-border-sm mx-1 mt-1"));

          // Bounds and BBox
          const finalBounds = scrollBounds ?? initialBounds;
          const bbox = _getBBoxFromBounds(finalBounds);
          
          // remove "Previous heatmap"
          existingHeatmap && _removeHeatMap(existingHeatmap);

          // add "New Heatmap"
          _showHeatMap(resPoiLayers, bbox);
        }
      });

      /// ------------------------------- POIS LIST MAPPING ------------------------- ///
      PointOfInterestList.map((eachPoiGroup) => {
        const {id: poiGroupId, name: poiGroupName} = eachPoiGroup;

        // Appending "All-Pois-Groups" inside Div
        $poisGroupList.append(
          `<div 
            class="d-flex justify-content-between align-items-center rounded-lg p-2"
            href="#${poiGroupId}"
          >
            <span class="cursor-pointer">${poiGroupName}</span>
            <span class="d-flex align-items-center">
              <label id="selected-pois-count-${poiGroupId}" class="mb-0"></label>
              <i class="fa fa-angle-right pl-3 cursor-pointer font-weight-bold"></i>
            </span>
           </div>`
        );

        // create a new "Div" and "append" all "pois" 
        var newDiv = $("<div>", {id: `${poiGroupId}`, "class": "tab-pane fade"});
        $poisList.append(newDiv);
        
        const $poiListDiv = $(`#${poiGroupId}`);
        // adding "Title" for "Pois-Listing"
        $poiListDiv.append(`<span class="h5 mb-0 text-truncate">${poiGroupName}</span><hr class="my-2" />`);
        
        // Appending "All-Pois" of specific "Poi-Group" inside div
        eachPoiGroup.childrens.map((eachPoiName) => {
          // creating ID from name(has space between & spcl char) (for Loader)
          const eachPoiNameId = eachPoiName.replace(/[^\w ]/g, '').split(" ").join("-");

          // appending "all-pois"
          $poiListDiv.append(
            `<div class="d-flex justify-content-between align-items-center p-1">
              <span>${eachPoiName}</span>
              <div class="d-flex">
                <div id="spinner-${eachPoiNameId}"></div>
                <button
                  data-poi-name="${eachPoiName}"
                  data-poi-group-name="${poiGroupName}"
                  data-poi-group-id="${poiGroupId}"
                  class="btn shadow-none add-button btn-poi-select"
                >
                  Add
                </button>
              </div>
             </div>`
          )
        })
      });

      /// Enable tabbable tabs via JavaScript (each tab needs to be activated individually)
      $('#poi-groups-list div').on('click', function (e) {
        e.preventDefault();
        $(this).tab('show');
      })

      /// ------------------------- SELECT POI GROUP --------------------------- ///
      const $poiSelectButton = $(".btn-poi-select");
      $poiSelectButton.on('click', function(){
        const $poiBtn = $(this);
        // get poiGroupName and poiName
        const { poiGroupName, poiGroupId, poiName } = $poiBtn.data();
          
        // updating Variables
        selectedPoiName = poiName;
        selectedPoiGroupName = poiGroupName;

        // getting "Total Selected Poi Counts"
        const totalSelectedPoiCount = Object.keys(finalSelectedPoisInfo).reduce((acc, poiGroupKey) => 
          acc + finalSelectedPoisInfo[poiGroupKey].length, 0);
          
        // if SAME-POI selected
        if ($poiBtn.text() === "Added") {
          // Change the colour and text of the current button
          $poiBtn.removeClass('selected').text('Add');
          
          // updating "finalSelectedPoisInfo" for final submission (generate-report)
          Object.keys(finalSelectedPoisInfo).map((poiGroupKey) => {
            // key to check if already "poiName" exist or not in "poiGroups"
            const isPoiNameExist = finalSelectedPoisInfo[poiGroupKey].includes(poiName);
            
            // removed selected poi
            if (isPoiNameExist) {
              const newpoiGroupArr = finalSelectedPoisInfo[poiGroupKey].filter((eachPoi) => eachPoi !== poiName);
              finalSelectedPoisInfo[poiGroupKey] = newpoiGroupArr;
            }
            
            // deleting the key from "finalSelectedPoisInfo" if there is "No-selected-pois" in "Group".
            if (finalSelectedPoisInfo[poiGroupKey].length === 0) {
              delete finalSelectedPoisInfo[poiGroupKey];
            }

            // setting selected poi-counts for poi-groups
            const selectedPoiCount = finalSelectedPoisInfo[poiGroupName]?.length || 0;
            $(`#selected-pois-count-${poiGroupId}`).text(selectedPoiCount === 0 ? "" : selectedPoiCount);
          });

          // remove corresponding poi-markers
          if (Object.keys(poisMarkerMap).includes(poiName)) {
            poisMarkerMap[poiName].forEach((exMarker) => {
              _removeMarker(exMarker);
            });

            // after removing markers, remove the "key" also from "poisMarkerMap"
            delete poisMarkerMap[poiName];
          };
          
        } else if (totalSelectedPoiCount >= 3) {
          // if user "SELECT MORE THAN 3 POI's" then show popup
          $(`#poi-limit-msg-modal`).modal("show");

        } else {
          // Change the colour and text of the current button
          $poiBtn.addClass('selected').text('Added');

          // Bounds and BBox
          const finalBounds = scrollBounds ?? initialBounds;
          const bbox = _getBBoxFromBounds(finalBounds);

          // Setting "Loading = true" for POI-Selection
          const poiNameId = poiName.replace(/[^\w ]/g, '').split(" ").join("-"); // creating ID from name(has space between & spcl char)
          $(`#spinner-${poiNameId}`).html(_spinner("spinner-border-sm mx-1 mt-1"));

          // calling API to get pois-locations
          _getPoiMarkers(bbox, poiName, poiGroupName, poisMarkerMap);

          // key to check if already "poiGroupName" exist or not in "finalSelectedPoisInfo"
          const isPoiGroupNameExist = Object.keys(finalSelectedPoisInfo).includes(selectedPoiGroupName);

          // adding poiGroups and Pois to "finalSelectedPoisInfo"
          if (!isPoiGroupNameExist) {
            finalSelectedPoisInfo[poiGroupName] = [poiName];
          } else {
            finalSelectedPoisInfo[poiGroupName].push(poiName);
          }

          // setting selected poi-counts for poi-groups
          const selectedPoiCount = finalSelectedPoisInfo[poiGroupName].length || 0;
          $(`#selected-pois-count-${poiGroupId}`).text(selectedPoiCount === 0 ? "" : selectedPoiCount);
        }
      });

      /// --------------------------- DOWNLOAD SAMPLE REPORT ------------------------ ///
      $sampleReportDownloadBtn.click(function (e) {
        $.ajax({
          type: "GET",
          url: "https://app.staging.admavin.com/api/v3/report/single_site/sample",
          dataType: "json",
          success: function (result) {
            alert("success");
          },
          error: function (result) {
            alert("error");
          },
        });
      });

      /// --------- VALIDATE EMAIL AND GENERATE REPORT ---------- ///
      function validateEmailAndGenerateReport(input) {
        var validRegex = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;

        if (input.value.match(validRegex)) {
            $invalidEmailMessage.html("");
            document.emailform.email.focus();

            // ---- collecting Data to pass in body --- ///
            const { inputLat, inputLng } = _getLatLngValues(); // Lat and Lng
            const finalZoomLevel = scrollZoom ?? initialZoom; // zoom
            const radiusOfInfluence = $radiusOptions.find(":selected").val(); // influenceRadius
            const locationName = searchedPlaceName; // searched locationName
            const emailId = $generateReportEmailInput.val();

            // Bounds and BBox
            const finalBounds = scrollBounds ?? initialBounds;
            const bbox = _getBBoxFromBounds(finalBounds);

            // TargetGroupInfo Object
            const targetGroupInfoObject = {};
            if (selectedTgName) {
              targetGroupInfoObject[selectedTgName] = selectedTgResultingPoiLayers;
            }
            
            // POI info Object
            const poiInfoObject = finalSelectedPoisInfo;
            
            // Constructing Bean
            const reportBean = {
              "latitude": inputLat,
              "longitude": inputLng,
              "bbox": bbox,
              "zoomLevel": finalZoomLevel,
              "radiusInMeter": radiusOfInfluence,
              "targetGroupInfo": targetGroupInfoObject,
              "poiInfo": poiInfoObject,
              "emailId": emailId,
              "locationName": locationName,
            };
            console.log("reportBean=", reportBean);
            
            // if email is valid then generating report
            $.ajax({
              type: "POST",
              url: "https://app.staging.admavin.com/api/v3/report/single_site/pdf",
              body: reportBean,
              success: function (result) {
                $contentForSubmission.css("display", "none");
                $contentForSuccess.css("display", "block");
                $contentForFailure.css("display", "none");
              },
              error: function (error) {
                $contentForSubmission.css("display", "none");
                $contentForSuccess.css("display", "none");
                $contentForFailure.css("display", "block");
                alert(error);
              },
            });
            return true;
        } else {
            $invalidEmailMessage.html("Invalid Email Id, Please check and try again.");
            document.emailform.email.focus();
            return false;
          }
      }

      /// ---- GENERATE REPORT MODAL CLOSE --> clearing all the states ----- ///
      $generateReportModal.on('hidden.bs.modal', function () {
        $contentForSubmission.css("display", "block");
        $contentForSuccess.css("display", "none");
        $contentForFailure.css("display", "none");
        $generateReportEmailInput.val("");
        $generateReportPrivacyCheck.prop('checked',false);
        $invalidEmailMessage.html("");
      })

      /// -------- STOP PROPAGATION (click + drag) ------ ////
      $cls_stopPropagation.on('click touchstart mousedown', function(e){
        e.stopPropagation();

        // NOTE :: for Modals(popup) we have to again open modal with there individual Id.
        $($(this).attr("data-target")).modal('show');
      })

       /// -------- STOP PROPAGATION (mousescroll) ------ ////
       $cls_stopPropagation.on('mousewheel', function(e){
        e.stopPropagation();
      })

      // "DOUBLE-CLICK-IGNORE" to all-Elements.
      $universalSelection.dblclick(function(e){
        e.preventDefault();
        e.stopPropagation();
      });
    </script>

    <!-- jquery, bootstrap js -->
    <!-- <script
      src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
      integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
      crossorigin="anonymous"
    ></script> -->
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js"
      integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
